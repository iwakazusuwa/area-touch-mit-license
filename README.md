# area-touch-mit-license

## 【Python】画像のタッチデータのエリア集計と可視化

画像内のエリアごとに、ユーザーの「好き・嫌い」座標タッチを集計・可視化するPythonツールです。  
車の写真を例に、調査データから各エリアの支持・不支持傾向を分析できます。

---

## 概要

- エリア定義ファイル（`xy_points.csv`）の多角形領域ごとに、ユーザーがタッチした「好き」「嫌い」ポイントを集計
- 同一エリア内で「好き」と「嫌い」が両方あれば相殺（カウントしない）ルールを適用
- 集計結果をExcelファイルに出力し、好き・嫌いの比率を散布図で可視化
- 相殺ルール適用後の有効な座標だけを抽出したCSVも生成可能

---

## ファイル構成

```
├─ analyzer.py # 集計・可視化ロジック（メイン処理）
├─ draw_helper.py # 【おまけ】ルール適用後座標を画像上に描画するコード
├─ xy_points.csv # エリア定義ファイル（多角形座標）
├─ sample.csv # 調査データ（好き・嫌いの座標データ）
└─ README.md # 本ドキュメント
```


---

## 使い方

### 1. 環境構築

Python3系が必要です。  
必要なパッケージは以下のコマンドでインストールしてください。

```
pip install pandas matplotlib openpyxl japanize-matplotlib streamlit opencv-python
```

2. エリア定義の準備
xy_points.csv に画像上の多角形エリアの頂点座標を用意します。
形式例はリポジトリ内のファイルを参照してください。

3. 調査データ準備
sample.csv は調査対象者のIDと「好き」「嫌い」ポイントの座標を含みます。
好き・嫌いは最大2点ずつ登録可能です。

4. 集計と可視化の実行
```
python analyzer.py
```
area_summary_rule.xlsx に集計結果（各エリアのlike/dislike/none数と比率）を書き出します。

好き vs 嫌い 比率の散布図を表示します。

5. ルール適用後の有効座標抽出（おまけ）
```
python draw_helper.py
```

相殺ルール適用後の「有効な」好き・嫌い座標のみを rule_xy_points.csv に書き出します。

その座標を元に、元画像に好き（青）・嫌い（赤）ポイントを描画し、rule_likes_dislikes.png として保存します。


## 集計ルール
```
| 状況（同一エリア内）        | カウント扱い                |
| ----------------- | --------------------- |
| like=1, dislike=0 | 〇（likeとして加算）          |
| like=0, dislike=1 | 〇（dislikeとして加算）       |
| like=2, dislike=0 | 〇（likeを1ポイントとして加算）    |
| like=0, dislike=2 | 〇（dislikeを1ポイントとして加算） |
| like≥1, dislike≥1 | ×（相殺しカウントなし）          |
| like=0, dislike=0 | ×（カウントなし）             |
```

注意点
- xy_points.csv の多角形座標は時計回りまたは反時計回りで、閉じた多角形として正しく順序付けしてください。

- タッチ座標が画像外、もしくは定義外のエリアにある場合は「none」として集計されます。

- 鋭角なエリアの場合、座標判定が意図と異なることがあるため、必ずプロット画像を確認してください。

LICENSE
MIT License（詳細はLICENSEファイルをご参照ください）

開発者： iwakazusuwa(Swatchp)
